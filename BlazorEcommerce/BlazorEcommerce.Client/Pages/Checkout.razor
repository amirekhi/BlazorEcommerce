@page "/checkout"

@using ClassLibrary1.DTOs.Entities
@using BlazorEcommerce.Client.Services
@using ClassLibrary1.Interfaces

@inject IClientOrderRepository OrderRepo
@inject IClientCartRepository CartRepo
@inject NavigationManager Navigation

@rendermode InteractiveWebAssembly

<div class="max-w-2xl mx-auto px-6 py-16">
    <h1 class="text-4xl font-semibold text-center mb-9 tracking-tight">Checkout</h1>

    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <p class="text-red-500 mb-6 text-center">@ErrorMessage</p>
    }

    <div class="space-y-8 bg-white p-8 rounded-2xl shadow-lg border-2  border-gray-200">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Shipping Address</label>
            <textarea @bind="OrderDto.ShippingAddress"
                      class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 text-gray-800 focus:outline-none focus:ring-2 focus:ring-black/70 focus:border-black/70 transition-all"
                      rows="4"
                      placeholder="123 Main St, City, Country..."></textarea>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
            <select @bind="OrderDto.PaymentMethod"
                    class="w-full p-4 border border-gray-300 rounded-xl text-gray-800 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-black/70 focus:border-black/70 transition-all">
                <option disabled value="">Select payment method</option>
                <option>Credit Card</option>
                <option>PayPal</option>
                <option>Cash on Delivery</option>
            </select>
        </div>

        <button @onclick="PlaceOrder"
                class="w-full bg-black text-white py-4 text-lg rounded-xl font-semibold hover:bg-neutral-800 transition-colors">
            Place Order
        </button>
    </div>
</div>

@code {
    private CreateOrderDto OrderDto = new();
    private string? ErrorMessage;

    private async Task PlaceOrder()
    {
        try
        {
            var cart = await CartRepo.GetCartAsync();
            if (cart == null || cart.Items.Count == 0)
            {
                ErrorMessage = "Your cart is empty.";
                return;
            }

            var result = await OrderRepo.CreateOrderAsync(OrderDto);
            Navigation.NavigateTo($"/ordersuccess/{result.Id}");
        }
        catch (Exception ex)
        {
            ErrorMessage = $"Order failed: {ex.Message}";
        }
    }
}